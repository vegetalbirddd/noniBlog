---
title: 输入URL后发生了什么
date: 2023-12-30
tags:
 - 计算机网络
categories: 
 - 计算机网络
---

# 输入URL后发生了什么

## 输入URL后渲染过程

- 输入URL之后，浏览器**解析URL**，确定了Web服务器和文件资源，**生成HTTP请求**。
- 还需要得到服务器域名对应的IP地址，所以需要发送**DNS请求**，通过DNS服务器拿到**IP地址**（**DNS解析**）。
- 拿到IP后，进行**TCP连接建立HTTP请求**
- 经过层层传递后，服务端拿到了HTTP请求，把**响应数据传给浏览器**
- 浏览器拿到HTTP响应数据后进行渲染。

## 渲染过程

- 通过HTML解析器解析出**DOM树**，CSS解析器解析出**CSS对象模型**
- 结合DOM和CSS，计算出DOM树每个节点的具体样式，**生成渲染树**
- 根据渲染树布局和绘制，触发**回流重绘**
- 构建图层树，显示页面

## TCP 建立连接——三次握手

- 第一次握手：客户端发送SYN的数据包给服务端
- 第二次握手：服务端接受SYN后把ACK和SYN数据包发送给客户端
- 第三次握手：客户端接收到数据后发送ACK数据给服务端

三次握手能保证双方具有接收和发送的能力

## 断开连接过程——TCP四次挥手

- 客户端打算关闭连接，此时会发送一个 TCP 首部 `FIN` 标志位被置为 `1` 的报文，也即 `FIN` 报文，之后客户端进入 `FIN_WAIT_1` 状态。
- 服务端收到该报文后，就向客户端发送 `ACK` 应答报文，接着服务端进入 `CLOSE_WAIT` 状态。
- 客户端收到服务端的 `ACK` 应答报文后，之后进入 `FIN_WAIT_2` 状态。
- 等待服务端处理完数据后，也向客户端发送 `FIN` 报文，之后服务端进入 `LAST_ACK` 状态。
- 客户端收到服务端的 `FIN` 报文后，回一个 `ACK` 应答报文，之后进入 `TIME_WAIT` 状态
- 服务端收到了 `ACK` 应答报文后，就进入了 `CLOSE` 状态，至此服务端已经完成连接的关闭。
- 客户端在经过 `2MSL` 一段时间后，自动进入 `CLOSE` 状态，至此客户端也完成连接的关闭。

## DNS解析的过程使用的传输层的什么协议

UDP协议

## 数据包扒皮过程

发送端->HTTP数据->TCP头部->IP头部->以太网头部->IP头部->TCP头部->HTTP数据->接收端

## 参考文献

https://xiaolincoding.com/network