---
title: 前端优化整理
date: 2024-01-08
tags:
 - 前端
 - 优化
categories: 
 - 浏览器
---


# 前端优化

面试的时候问到了，回答得一般般，在这里总结一些，持续更新……

## 首屏优化

### 概念

#### 首屏时间

首屏时间FCP（First Contentful Paint）：浏览器从响应用户输入网址地址，到首屏内容渲染完成的时间。

**影响因素：**

- 网络延迟
- 资源文件体积大
- 资源重复请求加载
- 加载脚本过程中渲染堵塞

**计算方式：**

首屏时间 = 首屏内容渲染结束时间点 - 开始请求的时间点

首屏时间的结束点一般认为是第一屏绘制完，因为无法直接得到时间点，所以需要获得第一屏内容底部位置，即首屏线，而计算方式也各不相同。

##### **标记首屏标签模块**

通过在HTML文档中，在首屏线的位置添加脚本去获取这个位置的时间。

**代码实现：**

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta>
  <title></title>
  <script>
    window.pageStartTime = Date.now()
  </script>
  <link rel="" href="">
  <script>
    window.firstPaint = Date.now()
  </script>
</head>
<body>
  <div>第一屏</div>
  <script type="text/javascript">window.firstScreen = Date.now();
  </script>
  <div></div>
  <div></div>
</body>
</html>
```

首屏时间 = window.firstScreen - window.pageStartTime

**适用场景：**

- 首屏内不需要拉取数据，否则可能拿到首屏线获取时间的时候，首屏还是空白
- 不需要考虑图片加载，只考虑首屏主要模块

在业务中，较少使用这种算法，大多数页面需要使用接口，所以这种方法就太不常用

但是如果你的页面是静态页面，或者异步数据不影响整体的首屏体验，那么就可以使用这种办法

##### 统计首屏最慢图片加载时间

拿到首屏内所有的图片，遍历它们，逐个监听图片标签的onload事件，并收集到它们的加载时间，取最大值。

**代码实现：**

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>统计首屏最慢图片加载时间</title>
  <script>
    window.pageStartTime = Date.now()
  </script>
</head>

<body>
  <img src="1" alt="img" onload="load()">
  <img src="2" alt="img" onload="load()">
  <script>
    function load() {
      window.firstScreen = Date.now()
    }
    window.onload = function () {
      // 首屏时间
      console.log(window.firstScreen - window.pageStartTime)
    }
  </script>
</body>
</html>
```

首屏时间 = window.firstScreen - window.pageStartTime

**适用场景：**

首屏元素数量固定的页面，比如移动端首屏不论屏幕大小都展示相同数量的内容。

##### 自定义模块计算法

这种算法和标记首屏的方法相似，同样忽略了首屏内图片加载的情况，这个方法主要考虑的是异步数据。

在首屏标签标记法中，是无法计算到异步数据带来的首屏空白的，所以它的适配场景十分有限

自定义模块，就是根据首屏内接口计算比较得出最迟的时间

**代码实现：**

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>自定义模块计算法</title>
  <script>
    window.pageStartTime = Date.now()
  </script>
</head>

<body>
  <div>第一屏</div>
  <script type="text/javascript">
    setTimeout(() => {
      // 假设这里异步加载首屏要显示的文章列表数据
      window.firstScreen = Date.now();
    }, 500)
  </script>
  <div></div>
</body>

</html>

```

首屏时间 = window.firstScreen - window.pageStartTime

##### **window.performance获取首屏时间**

`window.performance`能够获取到相应的时间节点，支持IE9以上浏览器。

首屏时间 = performance.getEntriesByName(“first-contentful-paint”)[0].startTime - navigationStart

>  navigationStart：同一个浏览器上一个页面卸载(unload)结束时的时间戳。如果没有上一个页面，这个值会和fetchStart相同

#### 白屏时间

白屏时间FP（First Paint）：是指浏览器从响应用户输入网址地址，到浏览器开始显示内容的时间。

**影响因素：**

- 网络
- 服务端性能
- 前端页面结构设计

**计算方式：**

白屏时间 = 页面开始展示的时间点 - 开始请求的时间点

通常认为浏览器开始渲染`<body>`或者解析完`<head>`的时间是白屏结束的时间点。所以我们可以在html文档的head中所有的**静态资源**以及**内嵌脚本/样式**的**前面**记录一个时间点，在head**最底部**记录另一个时间点，两者的**差值**作为白屏时间。

**代码实现：**

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta>
  <title></title>
  <script>
    window.pageStartTime = Date.now()
  </script>
  <link rel="" href="">
  <script>
    window.firstPaint = Date.now()
    console.log(`白屏时间：${}`)
  </script>
</head>
<body>
</body>
</html>
```

白屏时间= window.firstPaint - window.pageStartTime

缺点：无法获取解析HTML文档之前的时间信息。